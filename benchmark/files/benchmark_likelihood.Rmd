# likelihood.R

## mll

```{r likelihood mll, echo = FALSE, results = "asis"}

# Read in the data to be used for the mll. Consists of one person with 2500 
# samples.
data <- readRDS(file.path("..", "tests", "testthat", "data", "data_mll_benchmark.Rds"))

data <- readRDS(file.path("tests", "testthat", "data", "data_mll_benchmark.Rds"))
data <- data[data$id == "eqdyv", ]
data <- data[1:100, ]

full_data <- data 
for(i in 1:9) {
    data$id <- paste0("person_", i)
    full_data <- rbind(full_data, data)
}

# Create parameters that fall on the real axis and parameters that fall on the 
# bounded axis
params_bounded <- predped::params_from_csv[["params_archetypes"]][1, -c(1:2)]
params_real <- predped::to_unbounded(params_bounded, 
                                     predped::params_from_csv[["params_bounds"]])

# Do four tests, one distinguishing unbounded and bounded estimation and one
# distinguishing R from Rcpp.
bounded_r <- (\() predped::mll(full_data, params_bounded, transform = FALSE, cpp = FALSE)) |>
    test_times() |>
    rnd()

real_r <- (\() predped::mll(full_data, params_real, transform = TRUE, cpp = FALSE)) |>
    test_times() |>
    rnd()

bounded_rcpp <- (\() predped::mll(full_data, params_bounded, transform = FALSE, cpp = TRUE)) |>
    test_times() |>
    rnd()

real_rcpp <- (\() predped::mll(full_data, params_real, transform = TRUE, cpp = TRUE)) |>
    test_times() |>
    rnd()

# Create the table
tbl <- rbind(c("cpp = FALSE", 
               bounded_r[2], 
               paste0("[", bounded_r[1], ",", bounded_r[3], "]"), 
               real_r[2], 
               paste0("[", real_r[1], ",", real_r[3], "]")), 
             c("cpp = TRUE", 
               bounded_rcpp[2], 
               paste0("[", bounded_rcpp[1], ",", bounded_rcpp[3], "]"), 
               real_rcpp[2], 
               paste0("[", real_rcpp[1], ",", real_rcpp[3], "]")))
colnames(tbl) <- NULL

# Write the caption
caption <- paste0("Benchmark for the mll function. ",
                  "In this benchmark, we use 100 datapoints of 10 different people. ",
                  "We distinguish between providing parameters on the real axis ",
                  "(transform = TRUE) or on the bounded scale of predped ", 
                  "(transform = FALSE). ",
                  "We also distinguish between using the R version of this ", 
                  "function (cpp = FALSE) and the Rcpp version of this function ",
                  "(cpp = TRUE).")

tbl |>
    knitr::kable(format = "latex", 
                 align = "lll",
                 caption = caption,
                 longtable = FALSE,
                 booktabs = TRUE,
                 escape = FALSE,  
                 position = "H" ) |>
    kableExtra::add_header_above(c(" " = 1, "transform = FALSE" = 2, "transform = TRUE" = 2)) |>
    print()

```
