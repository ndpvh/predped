<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Interface to Minds for Mobile Agents • predped</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Interface to Minds for Mobile Agents">
<meta property="og:description" content="More about what it does (maybe more than one line)">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">predped</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">


<div class="section level1">
<div class="page-header"><h1 id="predped-an-r-package-to-simulate-the-minds-for-mobile-agents-m4ma-pedestrian-model">predped: An R package to simulate the Minds for Mobile Agents (M4MA) pedestrian model<a class="anchor" aria-label="anchor" href="#predped-an-r-package-to-simulate-the-minds-for-mobile-agents-m4ma-pedestrian-model"></a>
</h1></div>
<p>This project serves as a tool to simulate pedestrian movement using the Minds for Mobile Agents (M4MA) model. It contains several helper functions for people who wish to use the model to investigate pedestrian flow in their own settings. Before delving into how to use the package, we will first provide the reader with some background on the model.</p>
<div class="section level2">
<h2 id="background">Background<a class="anchor" aria-label="anchor" href="#background"></a>
</h2>
<p>Pedestrian models are popular tools to investigate how people navigate the complex world that we live in. While these models have certainly been useful to understand, for example, evacuation behavior, they most often assume that pedestrians are homogeneous – that is, that all pedestrians are one and the same. Because of this assumption, these pedestrian models are not suited to capture the variety of walking behaviors we observe in most low-density situations, such as those observed in the supermarket, in the train station, or even on the street.</p>
<p>To alleviate these difficulties, Andrew Heathcote, Dora Matzke, and Charlotte Tanis recently proposed M4MA to capture pedestrian movement. This model is based on the pedestrian model developed by Robin et al. (2009) and, similarly, proposes that pedestrian movement is determined on three levels: - <em>Strategic level</em>: Consists of planning where the pedestrian wants to go to and via which route. Typically, a pedestrian will have to fulfill a goal, which will serve as the destination of the route. To get to this goal, pedestrians will walk along so-called “path-points”: Waypoints along which the pedestrian can walk, serving as intermediate steps to get to their destination. - <em>Tactical level</em>: Once their route is determined, pedestrians will still be able to adapt if their original plan does not seem feasible. For example, other pedestrians can block your route, which makes avoiding the crowd more attractive when trying to get to your goal. These adaptations are handled on this level. - <em>Operational level</em>: This final level handles the low-level, moment-to-moment decisions about where to walk to. In practice, this constitutes a choice between one of 34 movement options, created by 11 angular directions in which a pedestrian can move (going from -72.5 to 72.5 degrees) and 3 changes in velocity (deceleration, constant speed, or acceleration), with the 34<sup>st</sup> option representing stopping. The probability with which a pedestrian will move to a given location is determined by a utility function that combines several moving components, namely (a) preferred speed, (b) current direction, (c) goal direction, (d) interpersonal distance, and (e) blocked angles, as well as several social components, namely (a) following a person heading in the same direction (follow-the-leader) and (b) walking besides someone heading in the same direction (walk-besides-buddy).</p>
<p>Critically, and different from other pedestrian models, M4MA assigns each pedestrian a “personality”, in that all pedestrians have their own unique values for the parameters that are defined on the operational level. These individual differences are implemented in two ways: - <em>Qualitative differences</em>: We define several “archetypes” of pedestrians, each of which have different discrete values for their parameters. These archetypes were created through trial-and-error by the researchers in this project and are contained in <em>archetypes.csv</em>. In no way should these archetypes be interpreted as ground truth or real differences between individuals. - <em>Quantitative differences</em>: Each of the parameter values that are defined in the archetypes CSV-file serves as a mean around which each pedestrian’s actual parameter value fluctuates. Without going into detail, each archetype has their own matrix that contains standard deviations for each parameter on the diagonal and correlations between parameters on the off-diagonal. These matrices are stored in <em>archetypes_sigma.Rds</em>.</p>
</div>
<div class="section level2">
<h2 id="how-to-use">How to use<a class="anchor" aria-label="anchor" href="#how-to-use"></a>
</h2>
<p>This package allows its users to simulate pedestrian behavior as expected by M4MA. Users can specify the environment, the characterstics the pedestrians, and the characteristics of the simulation itself (e.g., maximal number of agents, initial conditions,…), therefore allowing for a great variety of potential research questions that can be answered. For more information on the workflow of this package, see <em>Getting started</em>.</p>
<p>An unofficial benchmark is available through the repository. This package depends heavily on the <a href="https://github.com/m4ma/m4ma" class="external-link"><code>m4ma</code></a> package.</p>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>One can install <code>predped</code> through <code>devtools</code> in the following way:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">'devtools'</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">'ndpvh/predped'</span>, auth_token <span class="op">=</span> <span class="st">"PERSONAL_ACCESS_TOKEN"</span><span class="op">)</span></span></code></pre></div>
<p>Note that currently, <code>predped</code> is still a private package. This means that you should input your own personal access token to be able to download the package.</p>
<p>It is also useful to be mindful of the dependencies of <code>predped</code>. Currently, it imports <code>matrixStats</code>, <code>methods</code>, <code>m4ma</code>, and <code>ggplot2</code>. Of these, <a href="https://github.com/m4ma/m4ma" class="external-link"><code>m4ma</code></a> has also been developed by our lab.</p>
</div>
<div class="section level2">
<h2 id="getting-started">Getting started<a class="anchor" aria-label="anchor" href="#getting-started"></a>
</h2>
<p>The explanation in this section will follow the code contained within <em>getting_started.R</em>. A more elaborate example of how to use the package is contained within <em>demo.R</em>. Both scripts adhere to the same workflow.</p>
<p>Before you can get started, you should load the package:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">prepded</span><span class="op">)</span></span></code></pre></div>
<p>In the first step, you should define the environment in which you want pedestrians to walk around. For this, you will use the <code>background</code> class. This S4 class contains slots for the <code>shape</code> (i.e., the shape of the room), the <code>objects</code> (i.e., which objects are contained within the room), and a potential <code>entrance</code> and/or <code>exit</code>. The <code>shape</code> and <code>objects</code> should all consist of instances of the <code>object</code> class, that is they should be either a <code>rectangle</code>, <code>polygon</code>, or <code>circle</code>. The <code>entrance</code>/<code>exit</code> should be instances of the <code>coordinate</code> class.</p>
<p>A simple example of an environment is the following circular room with a square placed in the middle.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">setting</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/background-class.html">background</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="fu"><a href="reference/circle-class.html">circle</a></span><span class="op">(</span>center <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>, </span>
<span>                                     radius <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, </span>
<span>                      objects <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="reference/rectangle-class.html">rectangle</a></span><span class="op">(</span>center <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>, </span>
<span>                                               size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, </span>
<span>                                               interactable <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                      entrance <span class="op">=</span> <span class="fu"><a href="reference/coordinate-class.html">coordinate</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                      same_exit <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>In this chunk of code, the argument <code>interactable = TRUE</code> makes sure that the square in the middle of the room can contain goals for the pedestrians to fulfill. If none of the objects in the <code>objects</code> list are interactable, then the model will not be able to run. The argument <code>same_exit</code> defines whether the entrance and exit are at the same coordinate. If <code>same_exit = FALSE</code>, then a coordinate for the exit should also be provided.</p>
<p>It is good practice to visualize what the environment looks like. For this, we can use the <code>plot</code> function.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">setting</span><span class="op">)</span></span></code></pre></div>
<p>Now that we have defined the environment in which pedestrians will walk around, we have to define the characteristics of the pedestrians and link these with the environment in what is called a <code>predped</code> model. This is another S4 class with slots <code>setting</code> (the environment we just created), <code>parameters</code> (dataframe of parameter values), <code>archetypes</code> (a character string of pedestrians to include), and <code>weights</code> (the probability of each archetype entering the room).</p>
<p>For legacy reasons, the current package works with a dataframe that contains parameter values for a given “class” of people. One such dataframe is provided by us in <em>archetypes.csv</em> and can be called in the package through the variable <code>params_archetypes</code>. As you can see, this dataframe consists of different parameter values, as well as a “name” and “color”. The provided color will be the color that is used to plot the pedestrians when plotting out the results of the simulation. The name is what will be used to distinguish between different parameter sets, and concerns the variable that is selected upon based on the values of <code>archetypes</code> in the <code>predped</code> model. For example, if we only wish to have a simulation with <code>"BaselineEuropean"</code>s, then we can specify the model like.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/predped-class.html">predped</a></span><span class="op">(</span>id <span class="op">=</span> <span class="st">"my model"</span>, </span>
<span>                 setting <span class="op">=</span> <span class="va">setting</span>, </span>
<span>                 archetypes <span class="op">=</span> <span class="st">"BaselineEuropean"</span><span class="op">)</span></span></code></pre></div>
<p>Of course, you are free to specify whichever combination of archetypes you wish. Note that if you use more than one archetype and you want the probability of entering the room to be different for each of those, you should also provide values to the <code>weights</code> slot.</p>
<p>With the model defined, we can now finally simulate pedestrian movement. For this, we use the function <code>simulate</code> as follows.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trace</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/simulate.html">simulate</a></span><span class="op">(</span><span class="va">model</span>,</span>
<span>                  max_agents <span class="op">=</span> <span class="fl">25</span>, </span>
<span>                  iterations <span class="op">=</span> <span class="fl">50</span>,</span>
<span>                  plot_live <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>In this piece of code, we specify that within this simulation: - There can only be a maximum of 25 agents in the room; - It can only run for 50 iterations; - We want the pedestrian movement to be plotted to our plot while running the simulation (disclaimer: This is useful, but runs significantly slower than when <code>plot_live = FALSE</code>).</p>
<p>Once the simulation is done, the variable <code>trace</code> will be a list of different so-called intermediate “states” of the environment. Each state is another list containing the environment (under slot <code>setting</code>) and the pedestrians themselves (under slot <code>agents</code>). If you wish to visualize this trace, you can again use the <code>plot</code> function, this time with the additional argument <code>trace = TRUE</code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plots</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">trace</span>, </span>
<span>              trace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>The variable <code>plots</code> is a list containing a plot for each state in <code>trace</code>.</p>
</div>
<div class="section level2">
<h2 id="documentation">Documentation<a class="anchor" aria-label="anchor" href="#documentation"></a>
</h2>
<p>The documentation of m4ma is build with <code>roxygen2</code> and currently only locally available. See <code><a href="reference/predped-class.html">?predped</a></code> after installing the package.</p>
</div>
<div class="section level2">
<h2 id="contribute">Contribute<a class="anchor" aria-label="anchor" href="#contribute"></a>
</h2>
<p>While this model already came far, there are still many gaps in the behaviors it can capture. Some of these are currently being implemented, such as queueing and walking in group. Others may be missing without us knowing. If you want to give us pointers as to which behaviors should be implemented next, or if you otherwise wish to contribute to this project, feel free to reach out to Niels Vanhasbroeck (<a href="mailto:niels.vanhasbroeck@gmail.com" class="email">niels.vanhasbroeck@gmail.com</a>) and Andrew Heathcote (<a href="mailto:ajheathcote@gmail.com" class="email">ajheathcote@gmail.com</a>).</p>
</div>
<div class="section level2">
<h2 id="credits">Credits<a class="anchor" aria-label="anchor" href="#credits"></a>
</h2>
<p>The development of this package would not have been possible without the help of its many contributors. For the original implementation of the model, we thank (in alphabetical order):</p>
<ul>
<li><a href="https://github.com/andrewheathcote" class="external-link">Andrew Heathcote</a></li>
<li><a href="https://github.com/CharlotteTanis" class="external-link">Charlotte Tanis</a></li>
</ul>
<p>For the reworked version of <code>predped</code>, we thank several permanent project members (in alphabetical order):</p>
<ul>
<li><a href="https://github.com/andrewheathcote" class="external-link">Andrew Heathcote</a></li>
<li><a href="https://github.com/ndpvh" class="external-link">Niels Vanhasbroeck</a></li>
</ul>
<p>as well as many who worked with us temporarily (in alphabetical order):</p>
<ul>
<li><a href="https://github.com/Alexanderson31" class="external-link">Alexander Anderson</a></li>
<li><a href="https://github.com/JorisGoosen" class="external-link">Joris Goossen</a></li>
<li><a href="https://github.com/maltelueken" class="external-link">Malte Lüken</a></li>
<li><a href="https://github.com/eceyatikci" class="external-link">Ece Yatıkçı</a></li>
</ul>
</div>
<div class="section level2">
<h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a>
</h2>
<p>For more information on the project, please see its dedicated section on the lab website: <a href="https://www.ampl-psych.com/projects/minds-for-mobile-agents/" class="external-link">https://www.ampl-psych.com/projects/minds-for-mobile-agents/</a>.</p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Robin, T., Antonini, G., Beirlaire, M., &amp; Cruz, J. (2009). Specification, estimation, and validation of a pedestrian walking behavior model. <em>Transportation Research Part B, 43</em>, 36-56. doi: <a href="doi.org/10.1016/j.trb.2008.06.010">10.1016/j.trb.2008.06.010</a></p>
</div>
</div>

  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li>GPL v3</li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing predped</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li> c) <br><small class="roles"> Maintainer </small>  </li>
<li><a href="authors.html">More about authors...</a></li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/ndpvh/predped/actions/workflows/R-CMD-check.yaml" class="external-link"><img src="https://github.com/ndpvh/predped/actions/workflows/R-CMD-check.yaml/badge.svg" alt="build"></a></li>
<li><a href="https://github.com/ndpvh/predped/actions/workflows/test-coverage.yaml" class="external-link"><img src="https://github.com/ndpvh/predped/actions/workflows/test-coverage.yaml/badge.svg" alt="coverage"></a></li>
<li><a href="https://www.gnu.org/licenses/gpl-3.0" class="external-link"><img src="https://img.shields.io/badge/License-GPLv3-blue.svg" alt="license: GPL v3"></a></li>
</ul>
</div>

  </div>
</div>


      <footer><div class="copyright">
  <p></p>
<p>Developed by c).</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
