<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Interface to Minds for Mobile Agents • predped</title>
<script src="lightswitch.js"></script><script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Interface to Minds for Mobile Agents">
<meta name="description" content="Helper functions to allow simulating pedestrian flow with the Minds for Mobile Agents (M4MA) pedestrian model. Contains functions to generate environments, adapt pedestrian characteristics, and allow for a wide range of different kinds of simulation studies.">
<meta property="og:description" content="Helper functions to allow simulating pedestrian flow with the Minds for Mobile Agents (M4MA) pedestrian model. Contains functions to generate environments, adapt pedestrian characteristics, and allow for a wide range of different kinds of simulation studies.">
<script type="text/javascript" async="" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML"></script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">predped</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-usage" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Usage</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-usage">
<li><a class="dropdown-item" href="articles/m4ma.html">M4MA</a></li>
    <li><a class="dropdown-item" href="articles/workflow.html">Workflow</a></li>
    <li><a class="dropdown-item" href="articles/simulation.html">Advanced Simulation</a></li>
    <li><a class="dropdown-item" href="articles/estimation.html">Estimation</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
<li class="nav-item"><a class="nav-link" href="https://github.com/ndpvh/predped/" aria-label="Github"><span class="fa fa-github"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9">
<div class="section level1">
<div class="page-header"><h1 id="predped-an-r-package-to-simulate-the-minds-for-mobile-agents-m4ma-pedestrian-model">predped: An R package to simulate the Minds for Mobile Agents (M4MA) pedestrian model<a class="anchor" aria-label="anchor" href="#predped-an-r-package-to-simulate-the-minds-for-mobile-agents-m4ma-pedestrian-model"></a>
</h1></div>
<p>This project serves as a tool to simulate pedestrian movement using the Minds for Mobile Agents (M4MA) model. It contains several helper functions for people who wish to use the model to investigate pedestrian flow in their own settings. Before delving into how to use the package, we will first provide the reader with some background on the model.</p>
<div class="section level2">
<h2 id="background">Background<a class="anchor" aria-label="anchor" href="#background"></a>
</h2>
<p>Pedestrian models are popular tools to investigate how people navigate the complex world that we live in. While these models have certainly been useful to understand, for example, evacuation behavior, they most often assume that pedestrians are homogeneous – that is, that all pedestrians are one and the same. Because of this assumption, these pedestrian models are not suited to capture the variety of walking behaviors we observe in most low-density situations, such as those observed in the supermarket, in the train station, or even on the street.</p>
<p>To alleviate these difficulties, Andrew Heathcote and Dora Matzke recently proposed M4MA to capture pedestrian movement. This model is based on the pedestrian model developed by Robin et al. (2009) and, similarly, proposes that pedestrian movement is determined on three levels:</p>
<ul>
<li>
<em>Strategic level</em>: Consists of planning where the pedestrian wants to go to and via which route. Typically, a pedestrian will have to fulfill a goal, which will serve as the destination of the route. To get to this goal, pedestrians will walk along so-called “path-points”: Waypoints along which the pedestrian can walk, serving as intermediate steps to get to their destination.</li>
<li>
<em>Tactical level</em>: Once their route is determined, pedestrians will still be able to adapt if their original plan does not seem feasible. For example, other pedestrians can block your route, which makes avoiding the crowd more attractive when trying to get to your goal. These adaptations are handled on this level.</li>
<li>
<em>Operational level</em>: This final level handles the low-level, moment-to-moment decisions about where to walk to. In practice, this constitutes a choice between one of 34 movement options, created by 11 angular directions in which a pedestrian can move (going from -72.5 to 72.5 degrees) and 3 changes in velocity (deceleration, constant speed, or acceleration), with the <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mn>34</mn><mrow><mi>s</mi><mi>t</mi></mrow></msup><annotation encoding="application/x-tex">34^{st}</annotation></semantics></math> option representing stopping. The probability with which a pedestrian will move to a given location is determined by a utility function that combines several moving components, namely (a) preferred speed, (b) current direction, (c) goal direction, (d) interpersonal distance, and (e) blocked angles, as well as several social components, namely (a) following a person heading in the same direction (follow-the-leader) and (b) walking besides someone heading in the same direction (walk-besides-buddy).</li>
</ul>
<p>Critically, and different from other pedestrian models, M4MA assigns each pedestrian a “personality”, in that all pedestrians have their own unique values for the parameters that are defined on the operational level. These individual differences are implemented in two ways:</p>
<ul>
<li>
<em>Qualitative differences</em>: We define several “archetypes” of pedestrians, each of which have different discrete values for their parameters. These archetypes were created through trial-and-error by the researchers in this project and are contained in <em>archetypes.csv</em>. In no way should these archetypes be interpreted as ground truth or real differences between individuals.</li>
<li>
<em>Quantitative differences</em>: Each of the parameter values that are defined in the archetypes CSV-file serves as a mean around which each pedestrian’s actual parameter value fluctuates. Without going into detail, each archetype has their own matrix that contains standard deviations for each parameter on the diagonal and correlations between parameters on the off-diagonal. These matrices are stored in <em>archetypes_sigma.Rds</em>.</li>
</ul>
</div>
<div class="section level2">
<h2 id="how-to-use">How to use<a class="anchor" aria-label="anchor" href="#how-to-use"></a>
</h2>
<p>This package allows its users to simulate pedestrian behavior as expected by M4MA. Users can specify the environment, the characterstics the pedestrians, and the characteristics of the simulation itself (e.g., maximal number of agents, initial conditions,…), therefore allowing for a great variety of potential research questions that can be answered. For more information on the workflow of this package, see <em>Getting started</em>.</p>
<p>This package depends heavily on the <a href="https://github.com/m4ma/m4ma" class="external-link"><code>m4ma</code></a> package.</p>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>One can install <code>predped</code> through the <code>remotes</code> package in the following way:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">remotes</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"ndpvh/predped"</span><span class="op">)</span></span></code></pre></div>
<p>To use the package, you should load it through <code>library</code>:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ndpvh/predped">predped</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="getting-started">Getting started<a class="anchor" aria-label="anchor" href="#getting-started"></a>
</h2>
<p>Within <code>predped</code>, we use a particular workflow.</p>
<p>In the first step, you should define the environment in which you want pedestrians to walk around. For this, you will use the <code>background</code> class. This S4 class contains slots for the <code>shape</code> (i.e., the shape of the room), the <code>objects</code> (i.e., which objects are contained within the room), and a potential <code>entrance</code> and/or <code>exit</code>. The <code>shape</code> and <code>objects</code> should all consist of instances of the <code>object</code> class, that is they should be either a <code>rectangle</code>, <code>polygon</code>, or <code>circle</code>. The <code>entrance</code>/<code>exit</code> should be instances of the <code>coordinate</code> class.</p>
<p>A simple example of an environment is the following circular room with a square placed in the middle.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">setting</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/background-class.html">background</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="fu"><a href="reference/circle-class.html">circle</a></span><span class="op">(</span>center <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>, </span>
<span>                                     radius <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, </span>
<span>                      objects <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="reference/rectangle-class.html">rectangle</a></span><span class="op">(</span>center <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>, </span>
<span>                                               size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, </span>
<span>                                               interactable <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                      entrance <span class="op">=</span> <span class="fu"><a href="reference/coordinate-class.html">coordinate</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                      same_exit <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>In this chunk of code, the argument <code>interactable = TRUE</code> makes sure that the square in the middle of the room can contain goals for the pedestrians to fulfill. If none of the objects in the <code>objects</code> list are interactable, then the model will not be able to run. The argument <code>same_exit</code> defines whether the entrance and exit are at the same coordinate. If <code>same_exit = FALSE</code>, then a coordinate for the exit should also be provided.</p>
<p>It is good practice to visualize what the environment looks like. For this, we can use the <code>plot</code> function.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">setting</span><span class="op">)</span></span></code></pre></div>
<p>Now that we have defined the environment in which pedestrians will walk around, we have to define the characteristics of the pedestrians and link these with the environment in what is called a <code>predped</code> model. This is another S4 class with slots <code>setting</code> (the environment we just created), <code>parameters</code> (dataframe of parameter values), <code>archetypes</code> (a character string of pedestrians to include), and <code>weights</code> (the probability of each archetype entering the room).</p>
<p>For legacy reasons, the current package works with a dataframe that contains parameter values for a given “class” of people. One such dataframe is provided by us in <em>archetypes.csv</em> and can be called in the package through the variable <code>params_archetypes</code>. As you can see, this dataframe consists of different parameter values, as well as a “name” and “color”. The provided color will be the color that is used to plot the pedestrians when plotting out the results of the simulation. The name is what will be used to distinguish between different parameter sets, and concerns the variable that is selected upon based on the values of <code>archetypes</code> in the <code>predped</code> model. For example, if we only wish to have a simulation with <code>"BaselineEuropean"</code>s, then we can specify the model like.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/predped-class.html">predped</a></span><span class="op">(</span>id <span class="op">=</span> <span class="st">"my model"</span>, </span>
<span>                 setting <span class="op">=</span> <span class="va">setting</span>, </span>
<span>                 archetypes <span class="op">=</span> <span class="st">"BaselineEuropean"</span><span class="op">)</span></span></code></pre></div>
<p>Of course, you are free to specify whichever combination of archetypes you wish. Note that if you use more than one archetype and you want the probability of entering the room to be different for each of those, you should also provide values to the <code>weights</code> slot.</p>
<p>With the model defined, we can now finally simulate pedestrian movement. For this, we use the function <code>simulate</code> as follows.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trace</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/simulate.html" class="external-link">simulate</a></span><span class="op">(</span><span class="va">model</span>,</span>
<span>                  max_agents <span class="op">=</span> <span class="fl">25</span>, </span>
<span>                  iterations <span class="op">=</span> <span class="fl">50</span>,</span>
<span>                  plot_live <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>In this piece of code, we specify that within this simulation: - There can only be a maximum of 25 agents in the room; - It can only run for 50 iterations; - We want the pedestrian movement to be plotted to our plot while running the simulation (disclaimer: This is useful, but runs significantly slower than when <code>plot_live = FALSE</code>).</p>
<p>Once the simulation is done, the variable <code>trace</code> will be a list of different so-called intermediate “states” of the environment. Each state is another list containing the environment (under slot <code>setting</code>) and the pedestrians themselves (under slot <code>agents</code>). If you wish to visualize this trace, you can again use the <code>plot</code> function, this time with the additional argument <code>trace = TRUE</code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plots</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">trace</span>, </span>
<span>              trace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>The variable <code>plots</code> is a list containing a plot for each state in <code>trace</code>.</p>
</div>
<div class="section level2">
<h2 id="getting-help">Getting help<a class="anchor" aria-label="anchor" href="#getting-help"></a>
</h2>
<p>You can find the documentation for this package <a href="https://ndpvh.github.io/predped" class="external-link">here</a>. If you encounter a bug, you can report the bug with a minimal working example as an <a href="https://github.com/ndpvh/predped/issues">Issue</a>.</p>
</div>
<div class="section level2">
<h2 id="contribute">Contribute<a class="anchor" aria-label="anchor" href="#contribute"></a>
</h2>
<p>While this model already came far, there are still many gaps in the behaviors it can capture. Some of these are currently being implemented, such as queueing and walking in group. Others may be missing without us knowing. If you want to give us pointers as to which behaviors should be implemented next, or if you otherwise wish to contribute to this project, feel free to reach out to Niels Vanhasbroeck (<a href="mailto:niels.vanhasbroeck@gmail.com" class="email">niels.vanhasbroeck@gmail.com</a>) and Andrew Heathcote (<a href="mailto:ajheathcote@gmail.com" class="email">ajheathcote@gmail.com</a>).</p>
</div>
<div class="section level2">
<h2 id="credits">Credits<a class="anchor" aria-label="anchor" href="#credits"></a>
</h2>
<p>The development of this package would not have been possible without the help of its many contributors. For the development of the <code>m4ma</code> package, we thank (in alphabetical order):</p>
<ul>
<li><a href="https://github.com/andrewheathcote" class="external-link">Andrew Heathcote</a></li>
<li><a href="https://github.com/maltelueken" class="external-link">Malte Lüken</a></li>
<li><a href="https://github.com/CharlotteTanis" class="external-link">Charlotte Tanis</a></li>
</ul>
<p>For the creation of the <code>predped</code>, we thank several permanent project members (in alphabetical order):</p>
<ul>
<li><a href="https://github.com/andrewheathcote" class="external-link">Andrew Heathcote</a></li>
<li><a href="https://github.com/ndpvh" class="external-link">Niels Vanhasbroeck</a></li>
</ul>
<p>as well as many who worked with us temporarily (in alphabetical order):</p>
<ul>
<li><a href="https://github.com/Alexanderson31" class="external-link">Alexander Anderson</a></li>
<li><a href="https://github.com/JorisGoosen" class="external-link">Joris Goossen</a></li>
<li><a href="https://github.com/maltelueken" class="external-link">Malte Lüken</a></li>
<li><a href="https://github.com/eceyatikci" class="external-link">Ece Yatıkçı</a></li>
</ul>
</div>
<div class="section level2">
<h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a>
</h2>
<p>For more information on the project, please see its dedicated section on the lab website: <a href="https://www.ampl-psych.com/projects/minds-for-mobile-agents/" class="external-link">https://www.ampl-psych.com/projects/minds-for-mobile-agents/</a>.</p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Robin, T., Antonini, G., Beirlaire, M., &amp; Cruz, J. (2009). Specification, estimation, and validation of a pedestrian walking behavior model. <em>Transportation Research Part B, 43</em>, 36-56. doi: <a href="doi.org/10.1016/j.trb.2008.06.010">10.1016/j.trb.2008.06.010</a></p>
</div>
</div>

  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://ndpvh.github.io/predped" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/ndpvh/predped/issues">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li>
<a href="https://www.r-project.org/Licenses/GPL-3" class="external-link">GPL-3</a> + file <a href="LICENSE-text.html">LICENSE</a>
</li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing predped</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>
<a href="https://ndpvh.github.io" class="external-link">Niels Vanhasbroeck</a> <br><small class="roles"> Author, maintainer </small>   </li>
<li>
<a href="https://www.ampl-psych.com/team/andrew-heathcote/" class="external-link">Andrew Heathcote</a> <br><small class="roles"> Author, contributor, funder </small>   </li>
<li><a href="authors.html">More about authors...</a></li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/ndpvh/predped/releases"><img src="https://img.shields.io/badge/version-v0.1.0-blue" alt="version"></a></li>
<li><a href="https://ndpvh.github.io/predped" class="external-link"><img src="https://img.shields.io/badge/documentation-v0.1.0-blue" alt="documentation"></a></li>
<li><a href="https://github.com/ndpvh/predped/actions/workflows/R-CMD-check.yaml"><img src="https://github.com/ndpvh/predped/actions/workflows/R-CMD-check.yaml/badge.svg" alt="build"></a></li>
<li><a href="https://app.codecov.io/gh/ndpvh/predped" class="external-link"><img src="https://codecov.io/gh/ndpvh/predped/graph/badge.svg" alt="coverage"></a></li>
<li><a href="https://www.gnu.org/licenses/gpl-3.0" class="external-link"><img src="https://img.shields.io/badge/license-GPLv3-blue.svg" alt="license: GPL v3"></a></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://ndpvh.github.io" class="external-link">Niels Vanhasbroeck</a>, <a href="https://www.ampl-psych.com/team/andrew-heathcote/" class="external-link">Andrew Heathcote</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
